<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>モデル撮影プロンプター</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* LINE Seed JP のインポート */
        @import url('https://seed-static-assets.line-scdn.net/webfonts/line-seed-jp.css');

        body { 
            font-family: 'LINE Seed JP', sans-serif; 
            letter-spacing: -0.01em;
        }

        .theme-text { color: #18ABA0; }
        .theme-bg { background-color: #18ABA0; }
        .theme-border { border-color: #18ABA0; }
        .theme-ring { --tw-ring-color: #18ABA0; }

        .transition-all { transition-duration: 200ms; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .color-picker-input {
            width: 0; height: 0; padding: 0; margin: 0; border: none;
            visibility: hidden; position: absolute;
        }

        /* モーダルアニメーション */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-animate {
            animation: fadeIn 0.2s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const Icon = ({ name, size = 16, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide) { window.lucide.createIcons(); }
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const sceneDescriptions = {
                '都心の街並み': '東京の表参道のような洗練された都市の歩道。地面は清潔なグレーの石畳。背景にはモダンなガラス張りのビルと、整然と並ぶケヤキの街路樹。微かに高級車が路駐している清潔感のある都会の風景。',
                'おしゃれなカフェ前': 'ヴィンテージレンガの壁面が特徴的なカフェの入り口。黒いアイアンのテラス席と木製のテーブル。入り口横には大きなオリーブの鉢植え。落ち着いたヨーロッパ風の路地裏。',
                'コンクリート': '打ち放しコンクリートの壁が印象的な、モダンでミニマルな建築の外壁。規則的なセパレーターの跡が並ぶグレーの壁面が, 人物のシルエットを際立たせる背景となっている。地面はフラットなコンクリートで, 無機質で洗練された都市の片隅を演出している。',
                '自然豊かな公園': '手入れの行き届いた芝生が広がる開放的な公園。背景には深い緑の落葉樹の森。小道はベージュの砂利。木漏れ日が地面に水玉模様を作っている、穏やかで明るい自然光に包まれた場所。',
                'モダンなオフィス': 'ミニマルでモダンなオフィス空間。背景には黒いスチールフレームのガラスパーティションが整然と並び、空間に奥行きと構造的な美しさを与えている。木製のデスクやオフィスチェアが配置されたワークスペースは、機能的でありながら温かみのある北欧デザインを彷彿とさせる。',
                'ホテルのロビー': '高い天井と大理石の床が煌びやかな高級ホテルのロビー。背景には暖色の間接照明と、ベルベット素材の重厚なソファ。ラグジュアリーで静寂な空気感が漂う空間。',
                'ビーチ・リゾート': '白い砂浜とクリスタルブルーの穏やかな海。背景には数本のヤシの木。空は雲ひとつない快晴。リゾート地のプライベートビーチのような、色彩豊かで開放感溢れるロケーション。'
            };

            const studioVariations = {
                'ホワイトスタジオ（基本）': '完全に均一な白背景の撮影スタジオ。影の出にくい柔らかな照明が全体に回り、商品の色味と質感を最も正確に伝えるカタログスペックの環境。',
                '大きな窓のあるスタジオ': '床から天井まで続く大きな窓がある明るいスタジオ空間。午後の柔らかな自然光が部屋いっぱいに広がり、白やパステルトーンの壁面に反射する。空気感のある、透明度の高いライフスタイル写真。',
                'アンティークスタジオ': '重厚なダークウッドの床と、アンティーク調のモールディング壁。ヴィンテージ家具が一点置かれたクラシックな空間。深みのある暖色のライティングがドラマチックな陰影を作る。'
            };

            const options = {
                modelGender: ['男性', '女性', 'ノンバイナリー'],
                modelEthnicity: ['日本人', '韓国人系統', '欧米人', 'ハーフ（アジア×欧米）', 'アフリカ系', '南アジア系'],
                modelAge: ['10代後半', '20代前半', '20代後半', '30代', '40代', '50代以上'],
                modelType: ['細身', '標準', '筋肉質', 'プラスサイズ', '小柄', '高身長'],
                modelVibe: ['清潔感・爽やか', 'クール・モード', 'ストリート・無骨', '親しみやすい', 'ラグジュアリー', 'スポーティ', 'ヴィンテージ風'],
                angle: ['全身', '全身（顔切り）', '上半身（バストアップ）', '膝上（ニーアップ）', '足元・下半身のみ', '背面・バックショット', 'クローズアップ（素材寄り）'],
                pose: ['正面を向いた自然な立ち姿', 'リラックスして歩く動作', '両手をポケットに入れる', 'スマートフォンを操作する', '椅子に深く腰掛ける', 'バッグを手に持つ', 'ジャケットを肩に羽織る'],
                scene: [...Object.keys(sceneDescriptions), 'スタジオ'],
                lighting: ['自然光（日中）', '柔らかな逆光', '夕方のゴールデンアワー', 'スタジオ照明（影なし）', 'ドラマチックな影', '曇天（フラットな光）'],
                camera: ['一眼レフ（背景ボケ）', '全身シャープに撮影', '広角レンズ（パース感）', 'フィルムカメラ風', '35mmポートレート', '真上からの俯瞰'],
            };

            const labels = {
                modelGender: '性別', modelEthnicity: '国籍・系統', modelAge: '年齢層', modelType: '体格',
                modelVibe: '雰囲気', angle: 'アングル', pose: 'ポーズ', scene: 'ロケーション（固定背景描写）',
                lighting: 'ライティング', camera: 'カメラ・画角'
            };

            const [editableValues, setEditableValues] = useState({
                modelGender: '男性', modelEthnicity: '日本人', modelAge: '20代前半', modelType: '細身',
                modelVibe: '清潔感・爽やか', angle: '全身', pose: '正面を向いた自然な立ち姿',
                scene: sceneDescriptions['都心の街並み'], lighting: '自然光（日中）', camera: '一眼レフ（背景ボケ）',
            });

            const [isStudioOpen, setIsStudioOpen] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [studioColor, setStudioColor] = useState('#FFFFFF');
            const [uploadedImg, setUploadedImg] = useState(null);
            
            const [productInfo, setProductInfo] = useState('');
            const [sizeInfo, setSizeInfo] = useState('');
            const [coordinateInfo, setCoordinateInfo] = useState('');
            const [refComments, setRefComments] = useState({ slot1: '', slot2: '', slot3: '', slot4: '' });
            const [generatedPrompt, setGeneratedPrompt] = useState('');
            const [copied, setCopied] = useState(false);
            
            const studioDropdownRef = useRef(null);
            const colorPickerRef = useRef(null);
            const fileInputRef = useRef(null);
            const promptTextareaRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (studioDropdownRef.current && !studioDropdownRef.current.contains(event.target)) {
                        setIsStudioOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            // プロンプトエリアの高さ自動調整
            useEffect(() => {
                if (promptTextareaRef.current) {
                    promptTextareaRef.current.style.height = 'auto';
                    promptTextareaRef.current.style.height = promptTextareaRef.current.scrollHeight + 'px';
                }
            }, [generatedPrompt]);

            const handleChipClick = (key, val) => {
                if (key === 'scene') {
                    if (val === 'スタジオ') {
                        setIsStudioOpen(!isStudioOpen);
                    } else {
                        setIsStudioOpen(false);
                        setEditableValues(prev => ({ ...prev, [key]: sceneDescriptions[val] }));
                    }
                } else {
                    setEditableValues(prev => ({ ...prev, [key]: val }));
                }
            };

            const applyStudioPreset = (name) => {
                setEditableValues(prev => ({ ...prev, scene: studioVariations[name] }));
                setIsStudioOpen(false);
            };

            const applyStudioColor = (hex) => {
                const cleanHex = hex.startsWith('#') ? hex : `#${hex}`;
                setStudioColor(cleanHex);
                const desc = `完全に均一な単色の撮影スタジオ背景。背景色はWEBカラーコード「${cleanHex}」を厳密に再現すること。装飾を一切排除した無機質な空間で, 影の出にくい柔らかな照明が全体に回り, 商品の色味と質感を最も正確に伝えるプロ仕様の撮影環境。`;
                setEditableValues(prev => ({ ...prev, scene: desc }));
            };

            const pickColorFromImage = async () => {
                if (!window.EyeDropper) {
                    alert("お使いのブラウザはスポイト機能をサポートしていません（最新のChrome, Edge等で動作します）。");
                    return;
                }
                const eyeDropper = new window.EyeDropper();
                try {
                    const result = await eyeDropper.open();
                    applyStudioColor(result.sRGBHex);
                    setIsModalOpen(false); 
                    setIsStudioOpen(true);
                } catch (e) {
                    console.log("Color picking cancelled");
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setUploadedImg(event.target.result);
                        setIsModalOpen(true); 
                        setTimeout(() => {
                            pickColorFromImage();
                        }, 300);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleInputChange = (key, val) => {
                setEditableValues(prev => ({ ...prev, [key]: val }));
            };

            const handleRefCommentChange = (slot, val) => {
                setRefComments(prev => ({ ...prev, [slot]: val }));
            };

            const generate = () => {
                const displayProduct = productInfo.trim() || 'メインイメージに映っている商品の色、素材の質感、ディテールをそのまま維持する';
                const displaySize = sizeInfo.trim() || 'メインイメージにある衣服の形状、丈感、シルエット、ボリューム感を忠実に再現し、過度な形状補正を行わない';
                const displayCoord = coordinateInfo.trim() || 'メインイメージのスタイリングを尊重し、シンプルで調和の取れた構成にする';
                const angleStyle = editableValues.angle === '全身（顔切り）' ? '全身のポートレートだが, 首から上の顔部分はフレームアウト（カット）させ, 商品とスタイルに焦点を当てること。' : editableValues.angle;
                const refLines = Object.entries(refComments).filter(([_, val]) => val.trim() !== '').map(([key, val]) => `${key.replace('slot', '参考画像')}: ${val}`);
                const displayRefs = refLines.length > 0 ? `【参考画像への個別指示】\n${refLines.join('\n')}` : `【参考画像への指示】\nアップロードされた各参考画像から、ポーズ・顔立ち・背景のニュアンスを総合的に抽出し、反映する`;

                const prompt = `LOOK写真構成：\n【アングル】${angleStyle}\n【モデル】${editableValues.modelAge}、${editableValues.modelType}な${editableValues.modelEthnicity}の${editableValues.modelGender}。${editableValues.modelVibe}な雰囲気。\n\n【商品詳細】\n${displayProduct}\n\n【サイズ感・シルエット】\n${displaySize}\n\n【コーディネート】\n${displayCoord}\n\n【ロケーション詳細】\n${editableValues.scene}\n\n【ライティング・動作】\n${editableValues.lighting}のなか、${editableValues.pose}。\n\n${displayRefs}\n\n【撮影クオリティ】\n${editableValues.camera}。高解像度、2K、フォトリアル、商用カタログ品質、衣類の質感を正確に描写。不自然なロゴや文字は含めない。メインイメージにある服の固有のキャラクターを損なわないこと。`;
                setGeneratedPrompt(prompt);
            };

            const handlePromptEdit = (e) => {
                setGeneratedPrompt(e.target.value);
            };

            useEffect(() => { generate(); }, [editableValues, productInfo, sizeInfo, coordinateInfo, refComments]);

            const copyToClipboard = () => {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = generatedPrompt;
                    textArea.style.position = "fixed"; textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    setCopied(true); setTimeout(() => setCopied(false), 2000);
                } catch (err) { console.error('Copy failed: ', err); }
            };

            const isStudioSelected = editableValues.scene.includes('単色の撮影スタジオ背景');

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-800">
                    <div className="max-w-7xl mx-auto">
                        <header className="mb-10 text-center border-b border-slate-200 pb-8">
                            <h1 className="text-4xl font-black text-slate-900 flex items-center justify-center gap-3">
                                <Icon name="sparkles" size={40} className="text-[#18ABA0]" />
                                モデル撮影プロンプター
                            </h1>
                            <p className="text-slate-500 mt-4 text-sm font-bold leading-relaxed max-w-2xl mx-auto text-center">
                                モデル着用画像を作成するためのサポートツールです。<br />
                                必要事項を選択・入力することで指示テキストをまとめて作成してくれます。<br />
                                ファッションスタジオ/ウェアデザインラボを使う際にご利用ください。
                            </p>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                            <div className="lg:col-span-7 space-y-6">
                                <section className="bg-white p-6 rounded-2xl shadow-sm border-2 border-[#18ABA0]/10">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-3 text-slate-700">
                                        <Icon name="shopping-bag" size={20} className="text-[#18ABA0]" />
                                        STEP 1: 商品・コーディネート情報
                                    </h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="text-[10px] font-black text-slate-400 uppercase mb-1 block tracking-wider">商品詳細（素材・カラー）</label>
                                            <textarea className="w-full h-24 p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-[#18ABA0] focus:outline-none transition-all placeholder:text-slate-300" placeholder="例：綿100% ヘビーウェイト、ホワイト..." value={productInfo} onChange={(e) => setProductInfo(e.target.value)} />
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black text-slate-400 uppercase mb-1 block tracking-wider">サイズ・シルエット</label>
                                            <textarea className="w-full h-24 p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-[#18ABA0] focus:outline-none transition-all placeholder:text-slate-300" placeholder="未入力の場合、メインイメージの形状を100%尊重します" value={sizeInfo} onChange={(e) => setSizeInfo(e.target.value)} />
                                        </div>
                                        <div>
                                            <label className="text-[10px] font-black text-[#18ABA0] uppercase mb-1 block tracking-wider">コーディネートアイテム</label>
                                            <textarea className="w-full h-24 p-3 bg-[#18ABA0]/5 border border-[#18ABA0]/20 rounded-xl text-sm focus:ring-2 focus:ring-[#18ABA0] focus:outline-none transition-all placeholder:text-slate-400/50" placeholder="例：黒のカーゴパンツ、白スニーカー..." value={coordinateInfo} onChange={(e) => setCoordinateInfo(e.target.value)} />
                                        </div>
                                    </div>
                                </section>

                                <section className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                    <h2 className="text-lg font-bold mb-6 flex items-center gap-2 border-b pb-3 text-slate-700">
                                        <Icon name="layout" size={20} className="text-[#18ABA0]" />
                                        STEP 2: モデル & シーン調整
                                    </h2>
                                    <div className="space-y-6">
                                        {Object.entries(options).map(([key, vals]) => (
                                            <div key={key}>
                                                <label className="text-xs font-bold text-slate-400 uppercase tracking-[0.1em] mb-3 block">{labels[key]}</label>
                                                <div className="flex flex-wrap gap-2 mb-3">
                                                    {vals.map(val => (
                                                        <div key={val} className="relative" ref={val === 'スタジオ' ? studioDropdownRef : null}>
                                                            <button onClick={() => handleChipClick(key, val)} className={`flex items-center gap-1.5 px-3 py-2 rounded-lg text-[11px] font-bold transition-all ${(key === 'scene' && val === 'スタジオ' && (isStudioOpen || isStudioSelected)) ? 'bg-[#18ABA0] text-white shadow-md ring-2 ring-[#18ABA0]/20' : (key === 'scene' && val !== 'スタジオ' && editableValues[key] === sceneDescriptions[val]) || (key !== 'scene' && editableValues[key] === val) ? 'bg-[#18ABA0] text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                                                                {val} {val === 'スタジオ' && <Icon name="chevron-down" size={14} className={`transition-transform ${isStudioOpen ? 'rotate-180' : ''}`} />}
                                                            </button>
                                                            
                                                            {val === 'スタジオ' && isStudioOpen && (
                                                                <div className="absolute top-full left-0 mt-2 w-72 bg-white border border-slate-200 rounded-xl shadow-2xl z-50 p-4 ring-1 ring-black/5 overflow-y-auto max-h-[400px]">
                                                                    <div className="mb-4">
                                                                        <div className="text-[10px] font-black text-slate-400 uppercase mb-2 tracking-widest">プリセット選択</div>
                                                                        <div className="grid grid-cols-1 gap-1">
                                                                            {Object.keys(studioVariations).map(name => (
                                                                                <button key={name} onClick={() => applyStudioPreset(name)} className="text-left px-3 py-2 rounded-lg text-[11px] font-bold hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100">{name}</button>
                                                                            ))}
                                                                        </div>
                                                                    </div>
                                                                    <div className="mb-4 pt-4 border-t border-slate-100">
                                                                        <div className="text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest text-center">カスタムカラー設定</div>
                                                                        <div className="flex items-center gap-3">
                                                                            <button onClick={() => colorPickerRef.current.click()} className="w-10 h-10 rounded-full border-2 border-slate-200 shadow-inner shrink-0" style={{ backgroundColor: studioColor }} />
                                                                            <div className="flex-1">
                                                                                <input type="text" className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-xs font-bold focus:ring-2 focus:ring-[#18ABA0] focus:outline-none" value={studioColor} onChange={(e) => applyStudioColor(e.target.value)} placeholder="#FFFFFF" />
                                                                            </div>
                                                                            <input type="color" ref={colorPickerRef} className="color-picker-input" value={studioColor} onChange={(e) => applyStudioColor(e.target.value)} />
                                                                        </div>
                                                                        <div className="mt-3 grid grid-cols-5 gap-2">
                                                                            {['#FFFFFF', '#F3F4F6', '#E5E7EB', '#D1D5DB', '#FDF6E3'].map(c => (
                                                                                <button key={c} onClick={() => applyStudioColor(c)} className="w-full aspect-square rounded-md border border-slate-100 hover:scale-110 transition-transform" style={{ backgroundColor: c }} />
                                                                            ))}
                                                                        </div>
                                                                    </div>
                                                                    <div className="pt-4 border-t border-slate-100 text-center">
                                                                        <div className="text-[10px] font-black text-[#18ABA0] uppercase mb-2 tracking-widest">画像から色を抽出</div>
                                                                        <button onClick={() => fileInputRef.current.click()} className="w-full py-3 border-2 border-dashed border-slate-200 rounded-xl text-[10px] font-bold text-slate-400 hover:border-[#18ABA0] hover:text-[#18ABA0] transition-all flex flex-col items-center gap-1">
                                                                            <Icon name="upload" size={16} />{uploadedImg ? "画像を入れ替える" : "画像をアップロード"}
                                                                        </button>
                                                                        {uploadedImg && (
                                                                            <button onClick={() => { setIsModalOpen(true); setTimeout(() => pickColorFromImage(), 100); }} className="mt-2 w-full py-2 bg-[#18ABA0]/10 text-[#18ABA0] rounded-lg text-[10px] font-bold flex items-center justify-center gap-1 hover:bg-[#18ABA0]/20 transition-all">
                                                                                <Icon name="maximize" size={12} />画像を表示して色を抽出
                                                                            </button>
                                                                        )}
                                                                        <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileUpload} />
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="relative">
                                                    {key === 'scene' ? (
                                                        <textarea className="w-full h-24 p-4 bg-[#18ABA0]/5 border border-[#18ABA0]/10 rounded-xl text-sm font-bold focus:ring-2 focus:ring-[#18ABA0] focus:outline-none transition-all" value={editableValues[key]} onChange={(e) => handleInputChange(key, e.target.value)} />
                                                    ) : (
                                                        <input type="text" className="w-full px-4 py-2.5 bg-slate-100/50 border border-slate-200 rounded-xl text-sm font-bold focus:ring-2 focus:ring-[#18ABA0] focus:outline-none pr-10" value={editableValues[key]} onChange={(e) => handleInputChange(key, e.target.value)} />
                                                    )}
                                                    <Icon name="edit-3" size={14} className="absolute right-3 top-1/2 -translate-y-1/2 theme-text opacity-40 pointer-events-none" />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>

                                <section className="bg-white p-6 rounded-2xl shadow-sm border-2 border-slate-100">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-3 text-slate-700">
                                        <Icon name="list-checks" size={20} className="text-slate-400" />
                                        STEP 3: 参考画像への個別指示（任意）
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {[1, 2, 3, 4].map(num => (
                                            <div key={num}>
                                                <label className="text-[10px] font-black text-slate-400 uppercase mb-1 block tracking-wider">参考画像 {num} へのコメント</label>
                                                <textarea className="w-full h-20 p-3 bg-slate-50 border border-slate-100 rounded-xl text-xs font-bold focus:ring-2 focus:ring-[#18ABA0] focus:outline-none transition-all placeholder:text-slate-300" placeholder={`例：この画像のポーズを参考にして...`} value={refComments[`slot${num}`]} onChange={(e) => handleRefCommentChange(`slot${num}`, e.target.value)} />
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>

                            <div className="lg:col-span-5 space-y-6 lg:sticky lg:top-8">
                                <section className="bg-slate-900 text-slate-100 p-6 rounded-3xl shadow-2xl border border-slate-700">
                                    <div className="flex items-center justify-between mb-4 border-b border-slate-800 pb-4">
                                        <div>
                                            <h2 className="text-lg font-bold flex items-center gap-2 text-[#18ABA0]"><Icon name="refresh-cw" size={20} />コピー用 指示テキスト</h2>
                                            <div className="flex items-center gap-1.5 mt-1">
                                                <Icon name="type" size={12} className="text-slate-500" />
                                                <span className="text-[11px] font-bold text-slate-400">
                                                    文字数: <span className={generatedPrompt.length > 1000 ? "text-orange-400" : "text-[#18ABA0]"}>{generatedPrompt.length}</span> 文字
                                                </span>
                                            </div>
                                        </div>
                                        <button onClick={copyToClipboard} className={`flex items-center gap-2 px-6 py-3 rounded-xl text-sm font-black transition-all ${copied ? 'bg-green-500 text-white shadow-[0_0_20px_rgba(34,197,94,0.6)]' : 'bg-[#18ABA0] hover:bg-[#18ABA0]/80 hover:scale-[1.02] active:scale-95 shadow-[0_0_20px_rgba(24,171,160,0.4)]'}`}>
                                            <Icon name={copied ? "check-circle-2" : "copy"} size={16} /> {copied ? 'コピー成功' : 'コピーする'}
                                        </button>
                                    </div>
                                    <textarea 
                                        ref={promptTextareaRef}
                                        className="w-full bg-slate-800/40 p-5 rounded-2xl border border-slate-700/50 text-[12px] leading-relaxed font-bold font-mono text-slate-300 focus:ring-2 focus:ring-[#18ABA0] focus:outline-none transition-all resize-none overflow-hidden"
                                        value={generatedPrompt}
                                        onChange={handlePromptEdit}
                                        spellCheck="false"
                                        rows="1"
                                    />
                                    <p className="mt-4 text-[10px] text-slate-500 text-center font-bold">↑ 修正を加えると高さが自動で調整されます</p>
                                </section>
                            </div>
                        </div>

                        {/* カラー抽出用ポップアップモーダル */}
                        {isModalOpen && (
                            <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm">
                                <div className="bg-white rounded-3xl w-full max-w-2xl overflow-hidden shadow-2xl modal-animate">
                                    <div className="p-6 border-b border-slate-100 flex items-center justify-between">
                                        <h3 className="text-lg font-black text-slate-800 flex items-center gap-2">
                                            <Icon name="pipette" className="text-[#18ABA0]" />
                                            画像から色を抽出
                                        </h3>
                                        <button onClick={() => setIsModalOpen(false)} className="text-slate-400 hover:text-slate-600 p-2">
                                            <Icon name="x" size={24} />
                                        </button>
                                    </div>
                                    <div className="p-6">
                                        <div className="bg-slate-100 rounded-2xl overflow-hidden relative min-h-[300px] flex items-center justify-center border border-slate-200">
                                            <img src={uploadedImg} className="max-w-full max-h-[60vh] object-contain block mx-auto" style={{ opacity: 1, filter: 'none' }} />
                                        </div>
                                        <div className="mt-6 flex flex-col items-center gap-4">
                                            <p className="text-sm text-slate-500 font-bold">画像をアップロードしました。スポイトが起動しています。</p>
                                            <button 
                                                onClick={pickColorFromImage}
                                                className="px-8 py-4 bg-[#18ABA0] text-white rounded-2xl font-black text-lg shadow-xl hover:scale-[1.05] active:scale-95 transition-all flex items-center gap-3"
                                            >
                                                <Icon name="pipette" size={24} />
                                                スポイトを起動
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <footer className="mt-12 py-8 border-t border-slate-200 text-center text-slate-400 text-[10px] uppercase tracking-[0.2em] font-bold">
                            モデル撮影プロンプター | ver：2.1.0
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
